#!/usr/bin/env ruby
require 'optparse'
require 'fileutils'

unless File.exists?('formula.rb')
  STDERR.puts '*** No formula.rb found in the working directory'
  exit(1)
end

if ARGV.include? 'clean'
  FileUtils.rm_rf %w[ tmp-build tmp-install ], :verbose => true
  exit
end

$:.unshift File.expand_path('../../lib', __FILE__)
require 'debian_formula'

Object.__send__ :remove_const, :HOMEBREW_CACHE
HOMEBREW_WORKDIR = Pathname.new(Dir.pwd)
HOMEBREW_CACHE = HOMEBREW_WORKDIR+'src'
FileUtils.mkdir_p(HOMEBREW_CACHE)

require './formula'

klass = File.read('formula.rb')[/class (\w+)/, 1]
eval(klass).package!

